const path = require('path')
const webpack = require('webpack')
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = (env) => (
  require('./webpack-config-base')(env)({
    entry: [
      'webpack-hot-middleware/client',
      'bootstrap-loader',
      'index.js'
    ],

    // Don't use hashes in dev mode for better performance
    output: {
      path: path.resolve(__dirname, '../../build/app'),
      publicPath: '/',
      filename: '[name].js',
      chunkFilename: '[name].chunk.js'
    },

    styleLoaders: [
      'style-loader',
      {
        loader: 'css-loader',
        query: {
          modules: true,
          localIdentName: '[name]__[local]___[hash:base64:7]',
          importLoaders: 1,
          sourceMap: true,
          camelCase: true
        }
      },
      'postcss-loader'
    ],

    plugins: [
      // Always expose NODE_ENV to webpack, in order to use `process.env.NODE_ENV`
      // inside your code for any environment checks; UglifyJS will automatically
      // drop any unreachable code
      new webpack.DefinePlugin({
        'process.env': {
          NODE_ENV: JSON.stringify('development'),
          SERVER: false
        }
      }),
      new webpack.HotModuleReplacementPlugin(), // Tell webpack we want hot reloading
      new webpack.NoErrorsPlugin(),
      new HtmlWebpackPlugin({
        template: 'index.html',
        inject: true // Inject all files that are generated by webpack
      })
    ],

    devtool: 'cheap-module-eval-source-map'
  })
)
